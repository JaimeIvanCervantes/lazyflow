

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Axis Iterator &mdash; lazyflow 0.1 documentation</title>
    
    <link rel="stylesheet" href="static/default.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="lazyflow 0.1 documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="index.html">lazyflow 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="axis-iterator">
<span id="id1"></span><h1>Axis Iterator<a class="headerlink" href="#axis-iterator" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The Axisiterator has been designed to provide a way to iterate through two volumes which is easy on the eye. An example of a typical use ist:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">it</span> <span class="o">=</span> <span class="n">AxisIterator</span><span class="p">(</span><span class="n">roi</span><span class="p">,</span><span class="n">srcGrid</span><span class="p">,</span><span class="n">trgtGrid</span><span class="p">)</span>
<span class="k">for</span> <span class="n">src</span><span class="p">,</span><span class="n">trgt</span><span class="p">,</span><span class="n">mask</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
        <span class="n">target</span><span class="p">[</span><span class="n">trgt</span><span class="p">]</span> <span class="o">=</span> <span class="n">operation_on_source</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">src</span><span class="p">])[</span><span class="n">mask</span><span class="p">]</span>
</pre></div>
</div>
<p>trgt, src and mask represent slicings which can be applied to anything that implements the __getitem__(key) method, usually an n-dimensional array.
trgt specifies the slice in the target array, source specifies the slice in the source array. If the operation should inflate the data from the source
slice, the mask cuts it down to the appropriate size. The mask and trgt slices are always congruent.</p>
</div>
<div class="section" id="id2">
<h2>Inner Mechanics<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Consider the following example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">roi</span> <span class="o">=</span> <span class="n">Roi</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">90</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
<span class="n">srcGrid</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
<span class="n">trgtGrid</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">it</span> <span class="o">=</span> <span class="n">AxisIterator</span><span class="p">(</span><span class="n">roi</span><span class="p">,</span><span class="n">srcGrid</span><span class="p">,</span><span class="n">trgtGrid</span><span class="p">)</span>
</pre></div>
</div>
<p>It could be visualized like this:</p>
<div class="figure">
<a class="reference internal image-reference" href="images/iterator_exposition.svg"><img alt="iterator exposition" src="images/iterator_exposition.svg" /></a>
</div>
<p>Using this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">src</span><span class="p">,</span><span class="n">trgt</span><span class="p">,</span><span class="n">mask</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;src &#39;</span><span class="p">,</span><span class="n">src</span>
        <span class="k">print</span> <span class="s">&#39;trgt &#39;</span><span class="p">,</span><span class="n">trgt</span>
        <span class="k">print</span> <span class="s">&#39;mask &#39;</span><span class="p">,</span><span class="n">mask</span>
        <span class="k">print</span> <span class="s">&#39;--------------------------------------------------&#39;</span>
</pre></div>
</div>
<p>One will get the following output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">src</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">trgt</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">mask</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="o">--------------------------------------------------</span>
<span class="n">src</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">trgt</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">mask</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="o">--------------------------------------------------</span>
<span class="n">src</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">trgt</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">mask</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="o">--------------------------------------------------</span>
<span class="n">src</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">trgt</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">mask</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="o">--------------------------------------------------</span>
<span class="n">src</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">trgt</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">mask</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="o">--------------------------------------------------</span>
<span class="n">src</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">trgt</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">mask</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="o">--------------------------------------------------</span>
<span class="n">src</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">trgt</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">mask</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="o">--------------------------------------------------</span>
<span class="n">src</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">trgt</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">mask</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="o">--------------------------------------------------</span>
<span class="n">src</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">trgt</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="n">mask</span>  <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="o">--------------------------------------------------</span>
</pre></div>
</div>
<p>As you can see, for every trgt slice there is a correspondig src and mask slice. In the first step the roi gets broken down in a number of trgt slices:</p>
<div class="figure">
<a class="reference internal image-reference" href="images/iterator_roiToTrgtSlices.svg"><img alt="roi being broken down into trgt slices" src="images/iterator_roiToTrgtSlices.svg" /></a>
</div>
<p>This is achieved by getSubRois(self,point,grid,roi),which calls nextStop(self,start,grid,roi) and nextStarts(self,point,grid,roi) repeatedly. For each point nextStarts() returns
the next points where either the grid intersects the grid itself or the roi. nextStop() returns for each starting point the stopping point, meaning the next point where the grid
intersects itself or the roi AND the point where the volume of [start,stop] is greater then zero. Visualized:</p>
<div class="figure">
<a class="reference internal image-reference" href="images/iterator_nextStarts.svg"><img alt="getting all start points" src="images/iterator_nextStarts.svg" /></a>
</div>
<p>When you have all starting points, nextStop() can be used to find the next stopping point, IF there is one. Two examples:</p>
<div class="figure">
<a class="reference internal image-reference" href="images/iterator_nextStop.svg"><img alt="assigning stopping points" src="images/iterator_nextStop.svg" /></a>
</div>
<p>The last step is of course merely conceptual. Once the trgt space is segmented into trgt slices, each trgt slice is mapped to a src slice. This is done using the mapRoiToSource() method. HOW this mapping is
done is up to the developer. In the current implementation it fits the needs of image filtering. An illustration:</p>
<div class="figure">
<a class="reference internal image-reference" href="images/iterator_mapToSrc.svg"><img alt="mapping a trgt roi to the src roi" src="images/iterator_mapToSrc.svg" /></a>
</div>
<p>Now all that has to be done is to create the mask slice. Why is there a need for this? Sometimes the filter operation inflates the image and returns e.g. 3 channels even if you requested just one. The mask
slice cuts out the desired part. Here is an illustration:</p>
<div class="figure">
<a class="reference internal image-reference" href="images/iterator_mask.svg"><img alt="mapping a trgt roi to the src roi" src="images/iterator_mask.svg" /></a>
</div>
<p>Finally src,trgt and mask slices are grouped together and returned.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Axis Iterator</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#id2">Inner Mechanics</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/iterator.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="index.html">lazyflow 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Christoph Straehle, Bernhard X. Kausler, Thorben Kröger, Ullrich Köthe , Fred A. Hamprecht, Anna Kreshuk, Luca Fiaschi, Stuart Berg.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>
